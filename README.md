Проект реализует систему клиент-сервер на языке C++20, которая позволяет детектировать объекты на изображении, согласно правилам фильтрации по полигональным областям.
Состоит из:
1. Клиент. Программа, считывающая изображения из файла и полигоны, форматирует в формат .jpg и отправляет на сервер. Затем, выводит ответное изображение, с детектированными объектами, от сервера на экран.
2. Сервер. Программа принимающая изображение и полигоны от клиента, детектирует объекты на изображении, создает бинарные маски полигонов, ищет полигоны, пересекающиеся с объектом, смотрит количество пикселей в области пеперсечения, и в зависимости от правил площади пересечения, обводит объект или игнорирует. Итоговое изображение отсылает обратно клиенту.

### Действия перед началом сборки
**Warning**
Docker-desktop в ubuntu, может некорректно выставлять права доступа. Лучше испольвать docker-engine 

1.Установие docker-engine.

2. Перед запуском проекта, выполните команды в терминале, чтобы дать разрешение на подключения к X-серверу из контейнеров
```bash
xhost +local:docker
```

3. Если планируется ззапускать в режиме разработки скачайте: vscode и установите расширение Dev Containers от Microsoft.

4. Для работы модели определения необходимо скачать `yolov4.weights` file 245 MB: [yolov4.weights](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.weights) и поместитьт его в корень проекта, в папку YOLO.
Или воспользоваться командой из корня проекта:
```bash
wget -P YOLO https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.weights
```

### Cборка проекта в режиме разработки

Откройте проект в `Visual Studio Code`.
Нажмите `F1` и откройте проект в dev-контейнере командой `Dev Containers: Reopen in Container`.
После этого будет создан контейнер со всеми зависимостями.
В терминале контейнера нужно выполнить:

```bash
mkdir build && cd build
cmake ..
make
```
После этого проект будет собран.

Команда запуска тестов из корня проекта:
```bash
./build/tests/run_tests
```

Клиент и сервер поддерживают аргументы запуска.

Для запуска сервера

```bash
./build/src/server/server #Запуск сервера
./build/src/server/server -h #Вывод списка доступных аргументов
./build/src/server/server -p #Засупуск сервера с отоборажением полигонов, в результирующем изображении
```
Для запуска клиента

```bash
./build/src/server/client #Запуск клиента с изображнием 2.jpg и полигонами 2.json из папки image в корне проекта
./build/src/server/client -h #Вывод списка доступных аргументов
./build/src/server/client -i <Файл изображения> -p <Файл с полигонами> #Засупуск клиента с заданными пользователем изображением и набором полигонов
```
### Cборка проекта в режиме релиз

Для сборки прокта используется docker compose.

1. В корне прокта выполняем команду, после чего будут установленны все зависимости
```bash
docker compose build
```
2. Для запуска сервера можно использовать 
```bash
./runServer.sh #Запуск сервера
```
```bash
./runServer.sh -h #Вывод списка доступных аргументов
```
```bash
./runServer.sh -p #Засупуск сервера с отоборажением полигонов, в результирующем изображении
```

3. Для запуска клиента можно использовать

```bash
./runClient.sh #Запуск клиента с изображнием 2.jpg и полигонами 2.json из папки image в корне проекта
```
```bash
./runClient.sh -h #Вывод списка доступных аргументов
```
```bash
./runClient.sh -i <Файл изображения> -p <Файл с полигонами> #Засупуск клиента с заданными пользователем изображением и набором полигонов
```

Примеры полигонов и изображений можно найти в папке image в корне проекта.

### Набор полигонов JSON
Каждый полигон описывается объектом со следующими полями:
- `type` (integer) — тип полигона: 0 – включающий, 1 – исключающий.
- `priority` (integer) – приоритет обработки (чем больше, тем выше).
- `threshold` (float) – пороговое значение для детекции.
- `points` (array) – массив точек с координатами `x` и `y`.


### Пример набора полигонов JSONм
```json
{
  "polygons": [
    {
      "type": 0,
      "priority": 10,
      "threshold": 0.6,
      "points": [
        {"x": 10, "y": 10},
        {"x": 900, "y": 10},
        {"x": 900, "y": 800},
        {"x": 10, "y": 800}
      ]
    }, 
    {
      "type": 1,
      "priority": 10,
      "threshold": 0.5,
      "points": [
        {"x": 500, "y": 500},
        {"x": 800, "y": 500},
        {"x": 800, "y": 800},
        {"x": 500, "y": 800},
        {"x": 10, "y": 700}
      ]
    }
  ]
}
```
